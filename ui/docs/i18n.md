# Internationalization (i18n) Guide

The i18n system provides multi-language support for the application. Currently supported languages:
- **English (en)** - Default
- **German (de)**

The system automatically:
- Detects the user's browser language on first visit
- Persists language preference to `localStorage`
- Updates all UI text reactively when language changes

## File Structure

```
src/
├── i18n/
│   ├── index.ts      # Exports messages and types
│   ├── en.ts         # English translations
│   └── de.ts         # German translations
└── composables/
    └── useI18n.ts    # i18n composable
```

## Usage in Components

### Basic Usage

```vue
<script setup lang="ts">
import { useI18n } from '@/composables/useI18n'

const { t } = useI18n()
</script>

<template>
  <h1>{{ t.navbar.title }}</h1>
  <p>{{ t.common.loading }}</p>
</template>
```

### Using the `$t()` Function

For dynamic keys or nested access via string path:

```vue
<script setup lang="ts">
import { useI18n } from '@/composables/useI18n'

const { $t } = useI18n()

// Access nested translations with dot notation
const title = $t('navbar.title')
const region = $t('filters.regions.europe')
</script>
```

### In Computed Properties

When using translations in computed properties, access via `t.value`:

```vue
<script setup lang="ts">
import { computed } from 'vue'
import { useI18n } from '@/composables/useI18n'

const { t } = useI18n()

const options = computed(() => [
  { value: '', label: t.value.common.all },
  { value: 'active', label: t.value.filters.active }
])
</script>
```

### Language Switching

```vue
<script setup lang="ts">
import { useI18n } from '@/composables/useI18n'

const { locale, toggleLocale, setLocale, initLocale } = useI18n()

// Toggle between EN/DE
toggleLocale()

// Set specific language
setLocale('de')

// Initialize from localStorage or browser (call in onMounted)
initLocale()
</script>

<template>
  <button @click="toggleLocale">
    {{ locale.toUpperCase() }}
  </button>
</template>
```

## Translation File Structure

Each translation file exports an object with nested sections:

```typescript
// src/i18n/en.ts
export default {
  navbar: {
    title: 'STAC Atlas',
    subtitle: 'Geospatial Data Explorer',
    // ...
  },
  common: {
    loading: 'Loading...',
    save: 'Save',
    cancel: 'Cancel',
    // ...
  },
  filters: {
    spatialFilter: 'Spatial Filter',
    regions: {
      europe: 'Europe',
      asia: 'Asia',
      // ...
    },
    // ...
  },
  // ... more sections
}
```

### Available Sections

| Section | Description |
|---------|-------------|
| `navbar` | Header/navigation text |
| `common` | Shared UI elements (buttons, labels, messages) |
| `filters` | Filter sidebar labels and options |
| `bboxModal` | Bounding box modal text |
| `search` | Search section text |
| `collectionCard` | Collection card component text |
| `collectionDetail` | Collection detail page text |
| `pagination` | Pagination controls text |

## Adding a New Language

### Step 1: Create Translation File

Create a new file in `src/i18n/` (e.g., `fr.ts` for French):

```typescript
// src/i18n/fr.ts
export default {
  navbar: {
    title: 'STAC Atlas',
    subtitle: 'Explorateur de Données Géospatiales',
    logoAlt: 'Logo STAC Atlas',
    switchToGerman: 'Passer à l\'allemand',
    switchToEnglish: 'Passer à l\'anglais',
    switchToLightMode: 'Passer au mode clair',
    switchToDarkMode: 'Passer au mode sombre',
    information: 'Information'
  },
  common: {
    loading: 'Chargement...',
    error: 'Erreur',
    all: 'Tous',
    save: 'Enregistrer',
    cancel: 'Annuler',
    // ... translate all keys from en.ts
  },
  // ... translate all other sections
}
```

### Step 2: Update Index File

Add the new language to `src/i18n/index.ts`:

```typescript
import en from './en'
import de from './de'
import fr from './fr'  // Add import

export type Locale = 'en' | 'de' | 'fr'  // Add to type

export const messages = {
  en,
  de,
  fr  // Add to messages
}

export type Messages = typeof en
```

### Step 3: Update Language Toggle (Optional)

If you want to cycle through more than 2 languages, update the toggle logic in `useI18n.ts`:

```typescript
const toggleLocale = () => {
  const locales: Locale[] = ['en', 'de', 'fr']
  const currentIndex = locales.indexOf(currentLocale.value)
  const nextIndex = (currentIndex + 1) % locales.length
  setLocale(locales[nextIndex])
}
```

## Adding New Translations

### Step 1: Add to English File

Add the new key(s) to `src/i18n/en.ts`:

```typescript
export default {
  // ... existing sections
  myNewSection: {
    greeting: 'Hello',
    farewell: 'Goodbye'
  }
}
```

### Step 2: Add to All Other Language Files

Add the same keys with translated values to all other language files (`de.ts`, etc.):

```typescript
export default {
  // ... existing sections
  myNewSection: {
    greeting: 'Hallo',
    farewell: 'Auf Wiedersehen'
  }
}
```

### Step 3: Use in Component

```vue
<template>
  <p>{{ t.myNewSection.greeting }}</p>
</template>
```

## Best Practices

1. **Keep keys consistent** - All language files must have the same structure
2. **Use descriptive section names** - Group related translations together
3. **Avoid string interpolation in templates** - Use computed properties for complex strings
4. **Test all languages** - Switch languages to verify translations appear correctly
5. **Use `t.value` in computed/watch** - Direct `t` access is for templates only

## API Reference

### `useI18n()` Returns

| Property | Type | Description |
|----------|------|-------------|
| `locale` | `Readonly<Ref<Locale>>` | Current locale ('en' or 'de') |
| `t` | `ComputedRef<Messages>` | Reactive translation object |
| `$t(key)` | `(key: string) => string` | Get translation by dot-notation path |
| `setLocale(locale)` | `(locale: Locale) => void` | Set the current locale |
| `toggleLocale()` | `() => void` | Toggle between available locales |
| `initLocale()` | `() => void` | Initialize locale from storage/browser |

## Storage

- **Key**: `stac-atlas-locale`
- **Location**: `localStorage`
- **Values**: `'en'` | `'de'`

The HTML `lang` attribute is also updated when the locale changes for accessibility.
